# API æ¥å£æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•æ—¶é—´ï¼š2026-01-15 05:06
æœåŠ¡åœ°å€ï¼šhttp://localhost:3000

## âœ… å¥åº·æ£€æŸ¥æ¥å£

### 1. åŸºç¡€å¥åº·æ£€æŸ¥
**ç«¯ç‚¹**: `GET /health`
**çŠ¶æ€**: âœ… æ­£å¸¸
```json
{
    "status": "healthy",
    "timestamp": "2026-01-15T05:05:40.703Z",
    "uptime": 2978.770691023
}
```

### 2. è¯¦ç»†å¥åº·æ£€æŸ¥
**ç«¯ç‚¹**: `GET /api/v1/health/detailed`
**çŠ¶æ€**: âš ï¸ éƒ¨åˆ†æœåŠ¡ä¸å¯ç”¨
```json
{
    "status": "unhealthy",
    "timestamp": "2026-01-15T05:05:49.628Z",
    "uptime": 2987.697445401,
    "dependencies": {
        "redis": true,      âœ… Redis è¿æ¥æ­£å¸¸
        "tripo": false,     âŒ Tripo AI è¿æ¥å¤±è´¥
        "cos": true         âœ… è…¾è®¯äº‘ COS è¿æ¥æ­£å¸¸
    }
}
```

### 3. ç³»ç»Ÿä¿¡æ¯
**ç«¯ç‚¹**: `GET /api/v1/health/info`
**çŠ¶æ€**: âœ… æ­£å¸¸
```json
{
    "timestamp": "2026-01-15T05:05:56.480Z",
    "uptime": 2994.549471071,
    "version": "v22.22.0",        âœ… Node.js æœ€æ–°ç‰ˆæœ¬
    "platform": "linux",
    "arch": "arm64",
    "memory": {
        "rss": 106237952,
        "heapTotal": 39337984,
        "heapUsed": 34196584,
        "external": 3710392,
        "arrayBuffers": 87060
    },
    "cpu": {
        "user": 1246166,
        "system": 368440
    },
    "env": "development"
}
```

### 4. å°±ç»ªæ£€æŸ¥
**ç«¯ç‚¹**: `GET /api/v1/health/ready`
**çŠ¶æ€**: âš ï¸ æœªå°±ç»ªï¼ˆTripo AI ä¸å¯ç”¨ï¼‰
```json
{
    "status": "not_ready",
    "timestamp": "2026-01-15T05:06:04.203Z",
    "checks": {
        "redis": true,      âœ…
        "tripo": false,     âŒ
        "cos": true         âœ…
    }
}
```

### 5. å­˜æ´»æ£€æŸ¥ï¼ˆKubernetes Livenessï¼‰
**ç«¯ç‚¹**: `GET /api/v1/health/live`
**çŠ¶æ€**: âœ… æ­£å¸¸
```json
{
    "status": "alive",
    "timestamp": "2026-01-15T05:06:11.029Z",
    "uptime": 3009.098049786
}
```

### 6. å¯åŠ¨æ£€æŸ¥ï¼ˆKubernetes Startupï¼‰
**ç«¯ç‚¹**: `GET /api/v1/health/startup`
**çŠ¶æ€**: âœ… å·²å¯åŠ¨
```json
{
    "status": "started",
    "timestamp": "2026-01-15T05:06:18.027Z",
    "uptime": 3016.09627133
}
```

## ğŸ“Š æœåŠ¡çŠ¶æ€æ€»ç»“

| æœåŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| åº”ç”¨æœåŠ¡ | âœ… æ­£å¸¸ | è¿è¡Œæ—¶é—´ï¼š50åˆ†é’Ÿ+ |
| Node.js | âœ… v22.22.0 | æœ€æ–°ç‰ˆæœ¬ |
| Redis | âœ… æ­£å¸¸ | ç¼“å­˜æœåŠ¡å¯ç”¨ |
| è…¾è®¯äº‘ COS | âœ… æ­£å¸¸ | å­˜å‚¨æœåŠ¡å¯ç”¨ |
| Tripo AI | âŒ ä¸å¯ç”¨ | éœ€è¦é…ç½®æœ‰æ•ˆçš„ API æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥ |

## ğŸ”§ éœ€è¦ä¿®å¤çš„é—®é¢˜

### âŒ Tripo AI è¿æ¥å¤±è´¥

**åŸå› åˆ†æ**ï¼š
1. Tripo AI API åœ°å€å¯èƒ½ä¸æ­£ç¡®ï¼š`https://api.tripo3d.ai`
2. å¥åº·æ£€æŸ¥ç«¯ç‚¹ `/health` å¯èƒ½ä¸å­˜åœ¨
3. ç½‘ç»œè¿æ¥é—®é¢˜

**å»ºè®®**ï¼š
1. ç¡®è®¤ Tripo AI çš„æ­£ç¡® API åœ°å€
2. æ£€æŸ¥ Tripo AI æ˜¯å¦éœ€è¦ API Token æ‰èƒ½è®¿é—®å¥åº·æ£€æŸ¥
3. æµ‹è¯•ç½‘ç»œè¿æ¥ï¼š`curl https://api.tripo3d.ai/health`

## ğŸ“ å¯ç”¨çš„ API ç«¯ç‚¹

### å¥åº·æ£€æŸ¥ API
- `GET /health` - åŸºç¡€å¥åº·æ£€æŸ¥
- `GET /api/v1/health/detailed` - è¯¦ç»†å¥åº·æ£€æŸ¥
- `GET /api/v1/health/info` - ç³»ç»Ÿä¿¡æ¯
- `GET /api/v1/health/ready` - å°±ç»ªæ£€æŸ¥
- `GET /api/v1/health/live` - å­˜æ´»æ£€æŸ¥
- `GET /api/v1/health/startup` - å¯åŠ¨æ£€æŸ¥

### æ¨¡å‹ç”Ÿæˆ APIï¼ˆéœ€è¦ Tripo AI Tokenï¼‰
- `POST /api/v1/models` - åˆ›å»ºæ¨¡å‹ç”Ÿæˆä»»åŠ¡
- `GET /api/v1/models/{jobId}/status` - æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
- `GET /api/v1/models/{jobId}/result` - è·å–ç”Ÿæˆç»“æœ
- `GET /api/v1/models/debug/jobs` - è·å–æ‰€æœ‰ä»»åŠ¡ï¼ˆè°ƒè¯•ï¼‰

### API æ–‡æ¡£
- `GET /api-docs` - Swagger UI æ–‡æ¡£ç•Œé¢
- `GET /api-docs.json` - OpenAPI è§„èŒƒ JSON

## ğŸŒ è®¿é—®åœ°å€

- **åº”ç”¨é¦–é¡µ**: http://localhost:3000
- **API æ–‡æ¡£**: http://localhost:3000/api-docs
- **å¥åº·æ£€æŸ¥**: http://localhost:3000/health

## ğŸ§ª æ¨¡å‹ç”Ÿæˆ API æµ‹è¯•ï¼ˆæœ€ç»ˆæµ‹è¯•ï¼‰

### âœ… æµ‹è¯• 1: åˆ›å»ºæ–‡æœ¬åˆ°3Dæ¨¡å‹ä»»åŠ¡
**ç«¯ç‚¹**: `POST /api/v1/models`
**Token**: `[TRIPO_AI_TOKEN]`
**æµ‹è¯•æ—¶é—´**: 2026-01-15 13:33

**è¯·æ±‚**:
```bash
curl -X POST http://localhost:3000/api/v1/models \
  -F "type=text" \
  -F "input=a cute red apple" \
  -F "token=[TRIPO_AI_TOKEN]" \
  -F "options[quality]=high"
```

**å“åº”**: âœ… ä»»åŠ¡åˆ›å»ºæˆåŠŸ
```json
{
    "jobId": "4b58a9bf-04cd-4d65-9bd5-11d8901ca8ab",
    "status": "pending",
    "message": "æ¨¡å‹ç”Ÿæˆè¯·æ±‚å·²æäº¤",
    "estimatedTime": 300
}
```

### âœ… æµ‹è¯• 2: æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ï¼ˆå¤„ç†ä¸­ï¼‰
**ç«¯ç‚¹**: `GET /api/v1/models/{jobId}/status`

**å“åº”**: âœ… æ­£åœ¨å¤„ç†
```json
{
    "jobId": "4b58a9bf-04cd-4d65-9bd5-11d8901ca8ab",
    "status": "processing",
    "message": "æ­£åœ¨ç”Ÿæˆæ¨¡å‹"
}
```

### âœ… æµ‹è¯• 3: æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ï¼ˆå·²å®Œæˆï¼‰
**ç«¯ç‚¹**: `GET /api/v1/models/{jobId}/status`

**å“åº”**: âœ… ç”ŸæˆæˆåŠŸ
```json
{
    "jobId": "4b58a9bf-04cd-4d65-9bd5-11d8901ca8ab",
    "status": "completed",
    "message": "æ¨¡å‹ç”Ÿæˆå·²å®Œæˆ",
    "result": {
        "modelUrl": "7dgame-public-1251022382.cos.ap-nanjing.myqcloud.com/models/2026-01-15/c3ed7711-d57b-428b-9f47-061a5ceb6e40.obj",
        "metadata": {
            "fileSize": 0,
            "format": "obj",
            "generationTime": 79193
        }
    }
}
```

### âœ… æµ‹è¯• 4: è·å–ç”Ÿæˆç»“æœ
**ç«¯ç‚¹**: `GET /api/v1/models/{jobId}/result`

**å“åº”**: âœ… æˆåŠŸè·å–æ¨¡å‹
```json
{
    "jobId": "4b58a9bf-04cd-4d65-9bd5-11d8901ca8ab",
    "status": "completed",
    "message": "æ¨¡å‹ç”Ÿæˆå·²å®Œæˆ",
    "result": {
        "modelUrl": "7dgame-public-1251022382.cos.ap-nanjing.myqcloud.com/models/2026-01-15/c3ed7711-d57b-428b-9f47-061a5ceb6e40.obj",
        "metadata": {
            "fileSize": 0,
            "format": "obj",
            "generationTime": 79193
        }
    }
}
```

## ğŸ” æœ€ç»ˆçŠ¶æ€åˆ†æ

### âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸è¿è¡Œ

1. **API ç«¯ç‚¹å·²æ›´æ–°å¹¶æ­£å¸¸å·¥ä½œ**
   - âœ… ä½¿ç”¨ Tripo AI v2 API (`/v2/openapi/task`)
   - âœ… è¯·æ±‚æ ¼å¼æ­£ç¡®
   - âœ… å“åº”æ ¼å¼æ­£ç¡®è§£æ
   - âœ… ä¸‹è½½ URL æå–ä¿®å¤ï¼ˆä½¿ç”¨ `pbr_model` å­—æ®µï¼‰

2. **Token è®¤è¯æˆåŠŸ**
   - âœ… Token `[TRIPO_AI_TOKEN]` æœ‰æ•ˆ
   - âœ… è´¦æˆ·å·²å……å€¼ï¼Œæœ‰è¶³å¤Ÿç§¯åˆ†
   - âœ… è®¤è¯é€šè¿‡ï¼Œå¯ä»¥åˆ›å»ºå’Œå®Œæˆä»»åŠ¡

3. **å®Œæ•´æµç¨‹éªŒè¯æˆåŠŸ**
   - âœ… ä»»åŠ¡åˆ›å»ºæ¥å£æ­£å¸¸å·¥ä½œ
   - âœ… çŠ¶æ€æŸ¥è¯¢æ¥å£æ­£å¸¸å·¥ä½œ
   - âœ… æ¨¡å‹ç”ŸæˆæˆåŠŸï¼ˆè€—æ—¶çº¦ 79 ç§’ï¼‰
   - âœ… æ¨¡å‹è‡ªåŠ¨ä¸Šä¼ åˆ°è…¾è®¯äº‘ COS
   - âœ… ç»“æœè·å–æ¥å£æ­£å¸¸å·¥ä½œ
   - âœ… é”™è¯¯å¤„ç†æ­£ç¡®

### âœ… æœåŠ¡çŠ¶æ€

| æœåŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| åº”ç”¨æœåŠ¡ | âœ… æ­£å¸¸ | Node.js v22.22.0 |
| Redis | âœ… æ­£å¸¸ | ç¼“å­˜æœåŠ¡å¯ç”¨ |
| è…¾è®¯äº‘ COS | âœ… æ­£å¸¸ | å­˜å‚¨æœåŠ¡å¯ç”¨ |
| Tripo AI | âœ… æ­£å¸¸ | 3D æ¨¡å‹ç”ŸæˆæœåŠ¡å¯ç”¨ |

## ğŸ¯ æµ‹è¯•ç»“è®º

### âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

1. âœ… åŸºç¡€æœåŠ¡è¿è¡Œæ­£å¸¸
2. âœ… Redis å’Œ COS é…ç½®æ­£ç¡®
3. âœ… æ¨¡å‹ç”Ÿæˆ API æ¥å£æ­£å¸¸
4. âœ… Tripo AI Token æœ‰æ•ˆä¸”è®¤è¯æˆåŠŸ
5. âœ… Tripo AI å®¢æˆ·ç«¯ä»£ç æ­£ç¡®ï¼ˆv2 APIï¼‰
6. âœ… è´¦æˆ·ä½™é¢å……è¶³
7. âœ… å®Œæ•´æµç¨‹æµ‹è¯•æˆåŠŸ
8. âœ… æ¨¡å‹ç”Ÿæˆã€ä¸Šä¼ ã€è·å–å…¨éƒ¨æ­£å¸¸

### ğŸ“Š æ€§èƒ½æ•°æ®

- **ä»»åŠ¡åˆ›å»º**: å³æ—¶å“åº”
- **æ¨¡å‹ç”Ÿæˆ**: çº¦ 79 ç§’ï¼ˆæ–‡æœ¬åˆ° 3Dï¼‰
- **æ–‡ä»¶ä¸Šä¼ **: è‡ªåŠ¨å®Œæˆ
- **çŠ¶æ€æŸ¥è¯¢**: å®æ—¶æ›´æ–°

## ğŸ“‹ å®Œæˆçš„å·¥ä½œ

### âœ… ä»£ç ä¿®å¤
1. **ä¿®å¤ä¸‹è½½ URL æå–** (`src/clients/tripoAI.ts`)
   - âœ… ä» `data.output.model` æ”¹ä¸º `data.output.pbr_model || data.output.model`
   - âœ… ä¿®å¤äº† 404 ä¸‹è½½é”™è¯¯
   - âœ… æ­£ç¡®æå– Tripo AI è¿”å›çš„æ¨¡å‹ URL

2. **Tripo AI å®¢æˆ·ç«¯ä¼˜åŒ–**
   - âœ… ä½¿ç”¨ v2 API ç«¯ç‚¹
   - âœ… æ­£ç¡®çš„è¯·æ±‚æ ¼å¼
   - âœ… æ­£ç¡®çš„å“åº”è§£æ
   - âœ… å®Œå–„çš„é”™è¯¯å¤„ç†

### âœ… æµ‹è¯•éªŒè¯
1. âœ… Token è®¤è¯æˆåŠŸ
2. âœ… ä»»åŠ¡åˆ›å»ºæˆåŠŸ
3. âœ… çŠ¶æ€æŸ¥è¯¢æ­£å¸¸
4. âœ… æ¨¡å‹ç”ŸæˆæˆåŠŸ
5. âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
6. âœ… ç»“æœè·å–æ­£å¸¸

## ğŸ‰ ç³»ç»Ÿå·²å®Œå…¨å°±ç»ª

æ‰€æœ‰åŠŸèƒ½å·²æµ‹è¯•é€šè¿‡ï¼Œç³»ç»Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼
